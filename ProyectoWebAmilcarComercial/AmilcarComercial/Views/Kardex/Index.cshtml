
@{
    ViewBag.Title = "Kardex";
    ViewBag.SubTitle = "Kardex";
    ViewBag.ControllerGeneral = "Ventas";
    ViewBag.PrimaryColor = "blue";
    ViewBag.NavExtendedColor = "blue darken-1";
}

<div class="kardex">
    <div class="kardex-content row">
        <nav class="nav-extended @ViewBag.NavExtendedColor">
            @Html.Partial("_breadcrumbPartial")
        </nav>
        <div class="kardex-opciones col l12">
            <div class="option-bar col l6 offset-l3 white z-depth-1 border-radius-2">
                <form class="col l9">
                    <div class="input-field">
                        <input id="search" type="search" placeholder="Buscar Venta" required>
                    </div>
                </form>
                <div class="col l3">
                    <a class="tooltipped" data-position="bottomMio" data-delay="50" data-tooltip="Vista de cuadricula" onclick="articulos(0)"><i class="material-icons">view_module</i></a>
                    <a class="tooltipped info-sidenav show" data-position="bottomMio" data-delay="50" data-tooltip="Ver detalles"><i class="material-icons">info</i></a>
                    <a class="tooltipped" data-position="bottomMio" data-delay="50" data-tooltip="Actualizar"><i class="material-icons">refresh</i></a>
                    <a class="tooltipped dropdown-button" href="#!" data-activates="dropdown1" data-position="bottomMio" data-delay="50" data-tooltip="Opciones">
                        <i class="material-icons right">more_vert</i>
                    </a>
                    <!-- Dropdown Structure -->
                    <ul id='dropdown1' class='dropdown-content'>
                        <li><a href="#!">one</a></li>
                        <li><a href="#!">two</a></li>
                    </ul>

                </div>
            </div>
        </div>
        <div class="listado-kardex container-mio">
            <table class="bordered highlight centered white z-depth-1">
                <thead>
                    <tr>
                        <th>Cod-Art</th>
                        <th>Articulo</th>
                        <th>Categoria</th>
                        <th>Ultima Entrada</th>
                        <th>Ultima Salida</th>
                        <th>Stock Actual</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>  
</div>

<div class="modal-kardex">
    <div id="kardex" class="modal modal-giant">
        <div class="kardex blue">
            <div class="row white z-depth-1">
                <h4 class="grey-text text-darken-3 left-align"><i class="material-icons">info</i>
                <span></span>
                <i class="material-icons modal-close right">clear</i></h4>
            </div>
            <div class="modal-content row">
                <div class="col l12">
                    <div class="option-bar col l6 offset-l3 white z-depth-1 border-radius-2">
                        <form class="col l12">
                            <div class="input-field">
                                <input id="search" type="search" placeholder="Buscar Registro" required>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="lista-kardex">
                    <table class="bordered highlight centered white z-depth-1">
                        <thead>
                            <tr>
                                <th>Factura</th>
                                <th>Fecha</th>
                                <th>Entrada</th>
                                <th>Salida</th>
                                <th>Usuario</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts{
    <script type="text/javascript">
        $(document).ready(function () {
            listaKardex();
        });
        function listaKardex() {
            $.ajax({
                url: '/kardex/lista',
                type: 'GET',
                contentType: "application/json",
                dataType: "json",
                'success': function (data) {
                    $(".listado-kardex table tbody").empty();
                    $.each(data, function () {
                        $.each(this, function (name, value) {
                            $(".listado-kardex table tbody").append(
                                '<tr onclick="informacionVenta(' + value.ID + ')">' +
                                '<td>' + value.Cod + '</td>' +
                                '<td>' + value.Articulo + '</td>' +
                                '<td>' + value.Categoria + '</td>' +
                                '<td>' + value.EntradaFecha + '</td>' +
                                '<td>' + value.SalidaFecha + '</td>' +
                                '<td>' + value.Existencia + ' Unds</td>' +
                                '<td><i class="material-icons" onclick="detalleKardex(' + value.ID + ')">info</i></td>' +
                                '</tr>'
                            );
                        });
                    });
                },
                'error': function (request, error) {
                    alert("Request: " + JSON.stringify(request));
                }
            });
        }
        function detalleKardex(id) {
            $('#kardex').modal('open');
            $.ajax({
                url: '/kardex/detalle/' + id,
                type: 'GET',
                contentType: "application/json",
                dataType: "json",
                'success': function (data) {
                    $(".lista-kardex table tbody").empty();
                    $.each(data, function () {
                        $.each(this, function (name, value) {
                            $(".modal-kardex .kardex h4 span").text("Detalle de " + value.Articulo);
                            $(".lista-kardex table tbody").append(
                                '<tr>' +
                                '<td>' + value.NumFact + '</td>' +
                                '<td>' + value.Fecha + '</td>' +
                                '<td>' + value.Entrada + '</td>' +
                                '<td>' + value.Salida + '</td>' +
                                '<td>' + value.Nombre + ' ' + value.Apellido + '</td>' +
                                '</tr>'
                            );
                        });
                    });
                },
                'error': function (request, error) {
                    alert("Request: " + JSON.stringify(request));
                }
            });
        }
    </script>
}