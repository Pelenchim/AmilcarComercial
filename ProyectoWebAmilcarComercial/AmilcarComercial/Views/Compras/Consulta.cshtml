
@{
    ViewBag.Title = "Compras";
    ViewBag.SubTitle = "Consulta";
    ViewBag.ControllerGeneral = "Compras";
    ViewBag.PrimaryColor = "blue";
    ViewBag.NavExtendedColor = "blue darken-1";
}

<div class="consulta">
    <div class="consulta-content row">
        <nav class="breadcrumb-nav nav-extended @ViewBag.NavExtendedColor">
            @Html.Partial("_breadcrumbPartial")
        </nav>
        <div class="consulta-opciones col l12">
            <div class="option-bar col l4 offset-l4 white z-depth-1 border-radius-2">
                <div class="form col l11">
                    <div class="input-field col l10">
                        <input id="search" type="search" placeholder="Buscar Compra" required>
                    </div>
                    <div class="col l2 center search">
                        <a onclick="buscar()" class="left tooltipped waves-effect waves-block" data-position="bottomMio" data-delay="50" data-tooltip="Buscar"><i class="material-icons">search</i></a>
                    </div>
                </div>
                <div class="col l1 right-align icons">
                    <a class="tooltipped last" data-position="bottomMio" data-delay="50" data-tooltip="Imprimir" onclick="articulos(0)"><i class="material-icons">print</i></a>
                </div>
            </div>
        </div>
        <div class="detalle-consulta container-mio">
            <div class="vacio col l12 center grey-text text-lighten-1">
                <i class="material-icons">search</i>
                <p>Busca una compra para ver informacion <br /> detallada sobre esta.</p>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    function buscar() {
        var fact = $(".consulta .form #search").val();

        if (fact == "") {
            Materialize.toast("Debe ingresar el numero de factura", 2000);
            return;
        }
        $.ajax({
            url: '/compra/buscar/' + fact,
            type: 'GET',
            contentType: "application/json",
            'success': function (data) {
                if (data == false) {
                    Materialize.toast("No existe el registro", 3000);
                    return;
                }
                $(".detalle-consulta").empty();
                $(".detalle-consulta").append(
                    '<div class="col l8 offset-l2">' +
                    '<div>' + data.Estado+'</div>' +
                    '</div>' 
                );
            },
            'error': function (request, error) {
                Materialize.toast("No existe el registro", 3000);
            }
        });
        $.ajax({
            url: '/compra/detallebusqueda/' + fact,
            type: 'GET',
            contentType: "application/json",
            'success': function (data) {
                $(".detalle-consulta").append(
                    '<table class="responsive-table centered white z-depth-1 bordered highlight">' +
                    '<thead>' +
                    '<tr>' +
                    '<th>Nombre</th>' +
                    '<th>Imagen</th>' +
                    '<th>Cantidad</th>' +
                    '<th>Costo</th>' +
                    '<th>Descuento</th>' +
                    '</tr>' +
                    '</thead>' +
                    '<tbody>' +
                    '</tbody>' +
                    '</table>'
                );
                $.each(data, function () {
                    $.each(this, function (name, value) {
                        $(".detalle-consulta table tbody").append(
                            '<tr>' +
                            '<td>' + value.Nombre + '</td>' +
                            '<td><img src="/Content/images/articulos/' + value.Img + '"></td>' +
                            '<td>' + value.Cantidad + '</td>' +
                            '<td>' + value.Costo + '</td>' +
                            '<td>' + value.Descuento + '</td>' +
                            '</tr>'
                        );
                    });
                });
            },
            'error': function (request, error) {
            }
        });
    }
</script>